# Grooming Plan — 2026-02-23

## Themes Explored

- **Agent Architecture**: Migrate from custom planner loop → AI SDK 6 Agent + json-render catalog
- **Design Tokens**: CSS variables + Tailwind semantic token system
- **Memory & Context**: Mastra Observational Memory + compact user profile block
- **Backlog Hygiene**: Duplicates, legacy labels, missing canonical labels

## Directions Locked

| Theme           | Direction                                                       |
| --------------- | --------------------------------------------------------------- |
| Generative UI   | json-render (Vercel Labs) — catalog-constrained JSONL streaming |
| Agent framework | AI SDK 6 Agent — prepareStep, stopWhen, tool factory            |
| Tool pattern    | Moneta-style createCoachTools(userId) factory                   |
| Memory          | Mastra Observational Memory — 3-tier compression, AI SDK plugin |
| Design tokens   | CSS variables + Tailwind — semantic tokens, light/dark/system   |
| Accent color    | TBD — exploring beyond safety-orange                            |

## Issues Updated

- #341 Epic: Agentic UI Pivot — updated with all locked directions + child issue list
- #342 Migrate coach to AI SDK 6 + json-render — full implementation spec
- #349 Build json-render catalog — catalog schema + ToolSpec renderer pattern
- #344 Mastra Observational Memory — 3-tier architecture + user profile block
- #350 CSS variable design tokens — globals.css + Tailwind + component layer
- #346 Kickoff payload — pre-computed session assembly pattern

## Issues Created

- #362 [P2] Conversation state + action ranking — tiered next-best-actions (moneta pattern)

## Backlog Hygiene

**Closed (16 total):**

- #99, #98, #101, #100, #97, #96, #95, #94, #93, #85, #90 — duplicates of newer issues (session 1)
- #91 — superseded by design token refresh
- #74 — duplicate of #163 (test endpoint exposure)
- #73 — duplicate of #162 (curated exercise library)
- #66 — superseded by #190 (social sharing)
- #65 — superseded by #347 (analytics tools)

**Legacy labels migrated:**

- #77, #76, #75 — priority/now → canonical p3/p2 + type + source + domain
- #201 — priority/next → p3, task, later, domain/ui
- #361 — priority/next removed, `next` added
- #78–89, #102–108 — added missing priority + type + source + domain labels (~25 issues)

**vision.md → project.md:**

- Migrated to new format with domain glossary, quality bar, patterns, lessons learned
- vision.md trashed

## Deferred

- **Accent color exploration**: Needs dedicated `/design-sprint` session to explore beyond safety-orange
- **`/tune-repo`**: No CODEBASE_MAP.md or .glance.md files exist — recommend running after the agentic pivot settles
- **`/thinktank` validation**: New skill requires multi-model validation before locking directions. Skipped this session due to research depth being sufficient. Recommend for #342 architecture review before implementation starts.
- **`/issue lint` quality scoring**: New skill requirement — should score all new issues >= 70. Not yet available.

## Research Findings (Preserved)

### json-render

- GitHub: https://github.com/vercel-labs/json-render (11k+ stars)
- Chat mode mixes text + JSONL patches — perfect for coach conversation pattern
- Catalog constrains LLM output to pre-defined component schemas
- Pre-built shadcn/ui components available via @json-render/shadcn

### Mastra Observational Memory

- 94.87% on LongMemEval — highest recorded
- Observer: compresses at 30k tokens; Reflector: restructures at 40k tokens
- 5-40x compression on tool-heavy workloads
- AI SDK plugin: `@mastra/memory`
- Use Gemini Flash for compression (Claude 4.5 performs poorly as observer)

### Moneta patterns (reference repo: ../moneta)

- Key files: dashboard/ai/tax-tools.ts, dashboard/app/api/chat/route.ts
- Tool renderers: dashboard/lib/tool-renderers.ts (393 lines)
- Design tokens: dashboard/app/globals.css (279 lines)
- Action ranking: dashboard/lib/next-best-actions.ts (93 lines)

## Retro Patterns Applied

None — no prior retro data exists. First session.

## Recommended Execution Order

1. #350 Design tokens (effort/m) — foundation for all UI work
2. #342 AI SDK 6 + json-render (effort/xl) — load-bearing wall
3. #349 json-render catalog (effort/l) — depends on #342 + #350
4. #344 Mastra Observational Memory (effort/l) — depends on #342
5. #362 Action ranking (effort/m) — depends on #349
6. #346 Kickoff payload (effort/m) — depends on #342 + #349
