#!/usr/bin/env sh

# Scan for secrets before commit
if command -v trufflehog >/dev/null 2>&1; then
  echo "üîç Scanning for secrets..."
  trufflehog git file://. --only-verified --fail --no-update || {
    echo "‚ùå TruffleHog scan failed. This may be due to secrets being detected or an error in the scanner. Please review the output above."
    exit 1
  }
fi

pnpm exec lint-staged

# Warn if Convex functions are being committed
if git diff --cached --name-only | grep -q "^convex/.*\.ts$"; then
  echo ""
  echo "‚ö†Ô∏è  You're committing Convex function changes"
  echo "   Ensure you've tested with: pnpm dev"
  echo "   (runs both Next.js AND Convex)"
  echo ""
fi
