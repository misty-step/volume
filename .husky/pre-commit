# Scan for secrets before commit
if command -v trufflehog &> /dev/null; then
  echo "üîç Scanning for secrets..."
  trufflehog git file://. --only-verified --fail --no-update 2>/dev/null || {
    echo "‚ùå Secrets detected! Remove before committing."
    exit 1
  }
fi

pnpm exec lint-staged

# Warn if Convex functions are being committed
if git diff --cached --name-only | grep -q "^convex/.*\.ts$"; then
  echo ""
  echo "‚ö†Ô∏è  You're committing Convex function changes"
  echo "   Ensure you've tested with: pnpm dev"
  echo "   (runs both Next.js AND Convex)"
  echo ""
fi
