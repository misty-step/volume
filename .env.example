# Volume - Environment Variables Template
# Copy this to .env.local for local development

# === Local Development (Personal Dev Database) ===
# This deployment is for your local development and testing
CONVEX_DEPLOYMENT=dev:curious-salamander-943
NEXT_PUBLIC_CONVEX_URL=https://curious-salamander-943.convex.cloud

# === Convex Deploy Keys (Vercel Only - DO NOT set locally) ===
# These are set in Vercel dashboard and determine which Convex deployment
# receives your function deployments during build.

# Production (set in Vercel production environment):
# CONVEX_DEPLOY_KEY=prod:whimsical-marten-631|<secret>

# Preview (set in Vercel preview environment):
# CONVEX_DEPLOY_KEY=preview:phaedrus:volume|<secret>

# === Clerk Authentication (All Environments) ===
# Development: pk_test_* / sk_test_* / https://*.clerk.accounts.dev
# Production:  pk_live_* / sk_live_* / https://clerk.volume.fitness
NEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_YOUR_PUBLISHABLE_KEY_HERE
CLERK_SECRET_KEY=sk_test_YOUR_SECRET_KEY_HERE
CLERK_JWT_ISSUER_DOMAIN=https://your-clerk-domain.clerk.accounts.dev

# === OpenRouter API (Convex + Next.js Server) ===
# Unified LLM gateway for AI-powered features (default: MiniMax M2.5):
# - Coach agent (/api/coach)
# - Weekly/daily/monthly workout analysis reports
# - Exercise muscle group classification
# - Release notes generation (scripts)
#
# IMPORTANT: This key must be set in BOTH:
# - Convex environment (backend): npx convex env set OPENROUTER_API_KEY "sk-or-..."
# - For production: CONVEX_DEPLOYMENT=prod:... npx convex env set OPENROUTER_API_KEY "sk-or-..."
# - Vercel environment (server-side Next.js routes): OPENROUTER_API_KEY
# - GitHub Actions secrets (Cerberus): OPENROUTER_API_KEY
OPENROUTER_API_KEY=sk-or-v1-YOUR_OPENROUTER_API_KEY_HERE

# === Optional: Rate Limits (Convex) ===
# Set via `npx convex env set ...` (dev and prod deployments as needed).
# RATE_LIMIT_EXERCISE_PER_MIN=10
# RATE_LIMIT_COACH_PER_MIN=10
# RATE_LIMIT_REPORTS_PER_DAY=5

# === CRITICAL: Deployment Architecture ===
#
# Local Development:
#   - Uses CONVEX_DEPLOYMENT (points directly to dev deployment)
#   - No deploy key needed (read-only connection)
#   - Your personal sandbox for testing
#
# Vercel Production:
#   - Uses CONVEX_DEPLOY_KEY with "prod:" prefix
#   - Deploys functions to production Convex deployment
#   - NEXT_PUBLIC_CONVEX_URL auto-updated during build
#   - Production user data lives here
#
# Vercel Preview:
#   - Uses CONVEX_DEPLOY_KEY with "preview:" prefix
#   - Auto-creates isolated ephemeral deployment per PR
#   - Separate database from prod and dev
#   - Auto-cleanup after 14 days of inactivity
#
# === WARNING ===
# NEVER mix deployment names with wrong deploy keys!
# The deploy key determines which Convex deployment receives your functions.
# Getting this wrong can cause data to be deployed to the wrong environment.
#
# Example of WRONG configuration (causes data loss):
#   CONVEX_DEPLOYMENT=dev:curious-salamander-943  # ❌ Dev name
#   CONVEX_DEPLOY_KEY=prod:whimsical-marten-631   # ❌ Prod key
#   → Functions deploy to prod, but app connects to dev
#   → Result: App shows empty database
#
# Example of CORRECT configuration:
#   CONVEX_DEPLOY_KEY=prod:whimsical-marten-631   # ✅ Prod key only
#   → Convex auto-sets NEXT_PUBLIC_CONVEX_URL during build
#   → Functions and app both use production deployment

# === CRITICAL: 2025-10-29 Incident - Deployment Misconfiguration ===
#
# VERCEL ENVIRONMENTS (Production & Preview):
# ✅ DO: Set only CONVEX_DEPLOY_KEY
# ❌ DON'T: Set CONVEX_DEPLOYMENT (causes misconfiguration)
# ❌ DON'T: Set NEXT_PUBLIC_CONVEX_URL (Convex auto-sets during build)
#
# HOW IT WORKS:
# 1. vercel.json runs: npx convex deploy --cmd-url-env-var-name NEXT_PUBLIC_CONVEX_URL --cmd 'pnpm run build'
# 2. Convex CLI reads CONVEX_DEPLOY_KEY from environment
# 3. CLI deploys functions to key's target deployment
# 4. CLI injects NEXT_PUBLIC_CONVEX_URL automatically during build
# 5. App connects to correct deployment
#
# WHAT WENT WRONG (2025-10-29):
# - Vercel production had explicit CONVEX_DEPLOYMENT=dev:curious-salamander-943
# - Vercel production had CONVEX_DEPLOY_KEY=prod:whimsical-marten-631
# - Functions deployed to prod (via deploy key), but app connected to dev (via explicit URL)
# - Result: Production appeared to have empty database (data was safe in dev)
#
# THE FIX:
# - Removed CONVEX_DEPLOYMENT from Vercel environments
# - Removed NEXT_PUBLIC_CONVEX_URL from Vercel environments
# - Added --cmd-url-env-var-name flag to vercel.json build command
# - Now deploy key controls everything (single source of truth)


# ============================================================================
# Stripe Payments
# ============================================================================
# Setup: https://dashboard.stripe.com
#
# 1. Get API keys from Developers > API keys
# 2. Create products and prices in Product Catalog
# 3. Set up webhook endpoint for /api/webhooks/stripe
#
# API Keys (use test keys for development):
STRIPE_SECRET_KEY=sk_test_your_secret_key_here

# Webhook secret (from Stripe Dashboard > Webhooks > Signing secret):
# For local dev with `stripe listen`: use the secret printed in terminal
STRIPE_WEBHOOK_SECRET=whsec_your_webhook_secret_here

# Price IDs (from Product Catalog):
NEXT_PUBLIC_STRIPE_MONTHLY_PRICE_ID=price_your_monthly_price_id
NEXT_PUBLIC_STRIPE_ANNUAL_PRICE_ID=price_your_annual_price_id

# ============================================================================
# Testing (E2E / Playwright)
# ============================================================================
# Required for running Playwright tests in `e2e/`
#
# Test user credentials (should be a dedicated test user in Clerk):
CLERK_TEST_USER_EMAIL=test+e2e@volume.fitness
CLERK_TEST_USER_PASSWORD=your_secure_password

# Secret for wiping test user data (exercises, sets, reports) via API
# Must match the environment variable set in your Convex Dashboard:
# npx convex env set TEST_RESET_SECRET "your_random_string"
TEST_RESET_SECRET=your_random_string_here

# ============================================================================
# Sentry Error Tracking
# ============================================================================
# Setup: https://sentry.io/signup/
#
# 1. Create Sentry project (choose Next.js platform)
# 2. Copy DSN from Project Settings > Client Keys
# 3. Create auth token: User Settings > Auth Tokens > Create New Token
#    Required scopes: project:read, project:releases, org:read
# 4. In Vercel project settings:
#    - Add NEXT_PUBLIC_SENTRY_DSN (visible to browser)
#    - Add SENTRY_AUTH_TOKEN (secret, for source map uploads)
#    - Add SENTRY_ORG and SENTRY_PROJECT (for CLI)
#
# DSNs (client-side and server-side, can be same or different):
NEXT_PUBLIC_SENTRY_DSN=https://examplePublicKey@o0.ingest.sentry.io/0
SENTRY_DSN=https://exampleServerKey@o0.ingest.sentry.io/0

# Auth token for source map uploads (keep secret):
SENTRY_AUTH_TOKEN=sntrys_your_auth_token_here

# Organization and project slugs (from Sentry URL):
SENTRY_ORG=your-org-slug
SENTRY_PROJECT=your-project-slug

# Optional: Sampling rates (0.0 to 1.0)
# SENTRY_TRACES_SAMPLE_RATE=0.1              # Performance traces (10%)
# SENTRY_REPLAYS_SESSION_SAMPLE_RATE=0.05    # Session replays (5%)
# SENTRY_REPLAYS_ON_ERROR_SAMPLE_RATE=1.0    # Replays on error (100%)

# Optional: Disable in specific environments
# NEXT_PUBLIC_DISABLE_SENTRY=true

# ============================================================================
# Vercel (Speed Insights only - Analytics moved to PostHog)
# ============================================================================
# Speed Insights: Automatically enabled on Vercel deployments
# Web vitals (LCP, FCP, etc.) tracked via @vercel/speed-insights
# Dashboard: https://vercel.com/[team]/[project]/speed-insights

# ============================================================================
# PostHog Product Analytics
# ============================================================================
NEXT_PUBLIC_POSTHOG_KEY=phc_your_project_api_key
NEXT_PUBLIC_POSTHOG_HOST=https://us.i.posthog.com
